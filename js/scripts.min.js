$(function(){function t(){chrome.storage.sync.set({options:k})}function e(){n(),r(),a(),c(),i(),d()}function o(t){if(void 0!=t){var e=$("#"+t);$(".popout").not(document.getElementById(t)).removeClass("active"),e.hasClass("active")?e.removeClass("active"):e.addClass("active")}else $(".popout").removeClass("active")}function n(){k.customWallpaper.enabled?($("#btn-customwallpaper").show(),$("#add-customwallpaper img").attr("src","img/check.svg")):($("#btn-customwallpaper").hide(),$("#add-customwallpaper img").attr("src","img/uncheck.svg"))}function a(){k.search?($(".search").fadeIn(),$("#add-search img").attr("src","img/check.svg"),$("#query").focus()):($(".search").fadeOut(),$("#add-search img").attr("src","img/uncheck.svg"))}function c(){k.countdownTimer?($("#btn-countdowntimer").show(),$("#add-countdowntimer img").attr("src","img/check.svg")):($("#btn-countdowntimer").hide(),$("#add-countdowntimer img").attr("src","img/uncheck.svg"))}function i(){k.lightFonts?($("body").addClass("light"),$("#add-lightfonts img").attr("src","img/check.svg")):($("body").removeClass("light"),$("#add-lightfonts img").attr("src","img/uncheck.svg"))}function r(){if(k.customWallpaper.enabled&&""!=k.customWallpaper.url)$("body").css("background-image","url("+k.customWallpaper.url+")"),$("#input-customwallpaper").val(k.customWallpaper.url);else{var e,o=new Date;if(o=o.getDate()+"/"+(o.getMonth()+1)+"/"+o.getFullYear(),-1!=k.background.date)if(null==k.background.id||null==k.background.date||k.background.date!=o)k.background.date=o,t(),y.length>0?s():$.getJSON("https://unsplash.it/list",function(t){y=t,s()});else{var n=new Image,a="https://unsplash.it/1920/1080/?image="+k.background.id+"&element=body",c=new XMLHttpRequest;c.open("GET",a,!0),c.responseType="arraybuffer",c.onload=function(t){var e=new Uint8Array(this.response),o="",n,a,c,i=5e3;for(n=0,a=e.length;a>n;n+=i)c=e.subarray(n,n+i),o+=String.fromCharCode.apply(null,c);var r=btoa(o),s="data:image/jpeg;base64,"+r;l(s)},c.send()}}}function s(){var e=y[Math.floor(Math.random()*y.length)],o="https://unsplash.it/"+$(window).width()+"/"+$(window).height()+"/?image="+e.id+"&element=body";k.background.id=e.id,t(),l(o)}function l(t){var e=new Image;e.crossOrigin="",e.src=t;var o=0;e.onload=function(){C=document.getElementsByTagName("canvas")[0],D.drawImage(e,0,0);for(var n=D.getImageData(0,0,C.width,C.height),a=n.data,c,i,r,s,l=0,u=a.length;u>l;l+=4)c=a[l],i=a[l+1],r=a[l+2],s=Math.floor((c+i+r)/3),o+=s;var d=Math.floor(o/(this.width*this.height));d>150?$("body").addClass("black"):$("body").removeClass("black"),$(".bg").css("background-image","url("+t+")"),$("#btn-refresh").delay(1e3).removeClass("rotating"),window.setTimeout(function(){$("body").css("background-image","url("+t+")")},1e3)}}function u(t,e,o){e=e||"",o=o||512;for(var n=atob(t),a=[],c=0;c<n.length;c+=o){for(var i=n.slice(c,c+o),r=new Array(i.length),s=0;s<i.length;s++)r[s]=i.charCodeAt(s);var l=new Uint8Array(r);a.push(l)}var u=new Blob(a,{type:e});return u}function d(){k.chromeApps?($("#btn-chromeapps").show(),$("#add-chromeapps img").attr("src","img/check.svg")):($("#btn-chromeapps").hide(),$("#add-chromeapps img").attr("src","img/uncheck.svg"))}function m(){if(null===I){var t=new Date,e=t.getHours(),o=t.getMinutes();0===k.clock.military?(e%=12,e=e?e:12,e=0===e?"0"+e:e):e>12&&(e%=24,e=9>e?"0"+e:e),o=10>o?"0"+o:o;var n=e+":"+o;$(".clock h1").text(n),$(".widget.clock").fadeIn(1e3)}}function p(t){var e={google:"https://google.com",facebook:"https://www.facebook.com",youtube:"https://www.youtube.com",yahoo:"https://yahoo.com",wiki:"http://wikipedia.org",wikipedia:"http://wikipedia.org",twitter:"https://twitter.com",bing:"https://bing.com",pinterest:"https://www.pinterest.com",reddit:"https://www.reddit.com",wordpress:"https://wordpress.com",instagram:"https://instagram.com",tumblr:"https://www.tumblr.com",paypal:"https://www.paypal.com",imgur:"https://imgur.com",apple:"https://www.apple.com",microsoft:"https://www.microsoft.com",imdb:"https://www.imdb.com",stackoverflow:"https://stackoverflow.com",craigslist:"http://craigslist.com",netflix:"https://www.netflix.com",bbc:"http://www.bbc.co.uk",cnn:"http://cnn.com",dropbox:"https://www.dropbox.com",github:"https://github.com",gmail:"http://mail.google.com",flickr:"https://www.flickr.com",yelp:"http://www.yelp.com",godaddy:"https://www.godaddy.com",vimeo:"https://vimeo.com",etsy:"https://www.etsy.com",cnet:"http://cnet.com",slideshare:"http://www.slideshare.com",deviantart:"http://www.deviantart.com",forbes:"http://www.forbes.com",twitch:"http://www.twitch.tv",soundcloud:"https://soundcloud.com",quora:"https://www.quora.com",mailchimp:"http://mailchimp.com","9gag":"http://9gag.com",lifehacker:"http://www.lifehacker.com",fiverr:"https://www.fiverr.com",gizmodo:"http://www.gizmodo.com",trello:"https://trello.com",evernote:"https://evernote.com",kickstarter:"https://www.kickstarter.com",outlook:"https://outlook.com",xe:"http://www.xe.com"},o=t.toLowerCase();if(null!=e[o])return e[o];var n=new RegExp(" ","g");return t=t.replace(n,"+"),"https://google.com/search?q="+t}function w(){if(minutes=60*$("#input-minutes").val(),seconds=$("#input-seconds").val(),0===minutes.length)minutes=0;else{if(isNaN(minutes))return void $("#countdown .error").text("Must be a number").show();minutes=+minutes}if(0===seconds.length)seconds=0;else{if(isNaN(seconds))return void $("#countdown .error").text("Must be a number").show();seconds=+seconds}minutes>86400||seconds>86400?$("#countdown .error").text("Cannot countdown over 24 hours").show():minutes<0||seconds<0?$("#countdown .error").text("Number must be positive").show():($("#countdown .error").hide(),window.clearTimeout(T),x=minutes+seconds,h(),$("#btn-countdowntimer").addClass("rotating"),o())}function h(){g(),I=window.setInterval(v,1e3)}function g(){window.clearInterval(I),window.clearInterval(M),document.title="Tabbed",I=null,$(".clock h1").removeClass("flashing"),$("#countdown-stop").removeClass("active"),$("#btn-countdowntimer").removeClass("rotating"),A.pause()}function f(){W===!1?(W=!0,document.title="--:--"):(W=!1,document.title="00:00")}function v(){if($("#countdown-stop").addClass("active"),x-=1,0>=x)return window.clearInterval(I),I=null,A.currentTime=0,A.play(),document.title="00:00",$(".clock h1").text("00:00").addClass("flashing"),M=window.setInterval(f,500),void(T=window.setTimeout(g,5700));var t=Math.floor(x%31536e3%86400/3600),e=Math.floor(x%31536e3%86400%3600/60),o=x%31536e3%86400%3600%60;10>t&&(t="0"+t),10>e&&(e="0"+e),10>o&&(o="0"+o),"00"===t?($(".clock h1").text(e+":"+o),document.title=e+":"+o):($(".clock h1").text(t+":"+e+":"+o),document.title=t+":"+e+":"+o)}var b={background:{id:null,date:-1},customWallpaper:{enabled:!1,url:""},chromeApps:!1,clock:{military:!0},search:!0,countdownTimer:!1,lightFonts:!0},k=b;e(),chrome.storage.sync.get("options",function(t){k=$.extend({},b,t.options),-1==k.background.date&&(k.background.date=null),e()});var y={},C=document.createElement("canvas");C.width=$(window).width(),C.height=$(window).height(),document.body.appendChild(C);var D=C.getContext("2d"),x=0,I=null,T=null,M=null,W=!1,A=document.getElementById("buzzer"),q=!1;$(document).click(function(){o()}),$(".popout").click(function(t){t.stopPropagation()}),$(document).mousemove(function(){$(".menu").addClass("active");var t=(new Date).getTime();window.setTimeout(function(){var e=(new Date).getTime();q||$(".popout").hasClass("active")||e-t>1e3&&$(".menu").removeClass("active")},1e3)}),$(".icon img").each(function(){var t=$(this),e=t.attr("id"),o=t.attr("class"),n=t.attr("src");$.get(n,function(n){var a=$(n).find("svg");"undefined"!=typeof e&&(a=a.attr("id",e)),"undefined"!=typeof o&&(a=a.attr("class",o+" replaced-svg")),a=a.removeAttr("xmlns:a"),t.replaceWith(a)},"xml")}),$(".icon").hover(function(){q=!0},function(){q=!1}),$(".icon").click(function(t){t.stopPropagation()}),$("#btn-addons").click(function(t){o("addons"),t.preventDefault()}),$("#btn-about").click(function(t){o("about"),t.preventDefault()}),$("#add-customwallpaper").click(function(e){k.customWallpaper.enabled=!k.customWallpaper.enabled,t(),n(),e.preventDefault()}),$("#add-search").click(function(e){k.search=!k.search,t(),a(),e.preventDefault()}),$("#add-countdowntimer").click(function(e){k.countdownTimer=!k.countdownTimer,t(),c(),e.preventDefault()}),$("#add-lightfonts").click(function(e){k.lightFonts=!k.lightFonts,t(),i(),e.preventDefault()}),r(),$("#btn-refresh").click(function(t){k.customWallpaper.enabled=!1,k.background.id=null,$(this).addClass("rotating"),r(),t.preventDefault()}),$("#btn-customwallpaper").click(function(t){o("customwallpaper"),$("#input-customwallpaper").focus(),t.preventDefault()}),$("#input-customwallpaper").keypress(function(e){13==e.keyCode&&(k.customWallpaper.url=$(this).val(),t(),r(),o())}),$("#add-chromeapps").click(function(e){k.chromeApps=!k.chromeApps,t(),d(),e.preventDefault()}),$("#btn-chromeapps").click(function(t){chrome.tabs.update({url:"chrome://apps"}),t.preventDefault()}),m(),window.setInterval(m,100);var k={weekday:"long",year:"numeric",month:"long",day:"numeric"};$(".date h2").text((new Date).toLocaleDateString("en-GB",k)),$(".widget.date").fadeIn(1e3),$("#btn-clock").click(function(t){$(".widget.clock").stop(!0,!0).hide().fadeIn(500),k.clock.military=!k.clock.military,m(),t.preventDefault()}),$("#query").val(""),$("#query").keypress(function(t){13===t.keyCode&&(window.location=p($(this).val()))}),$("#btn-countdowntimer").click(function(t){o("countdown"),$("#input-minutes").focus(),t.preventDefault()}),$("#countdown-stop").click(function(t){g(),t.preventDefault()}),$("#input-minutes").keypress(function(t){13===t.keyCode&&w(t.keyCode)}),$("#input-seconds").keypress(function(t){13===t.keyCode&&w(t.keyCode)}),$(window).bind("beforeunload",function(){return null!==I?"A countdown timer is active, are you sure you want to leave?":void 0})});